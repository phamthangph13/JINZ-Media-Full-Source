{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { environment } from '../../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class AuthService {\n  constructor(http) {\n    this.http = http;\n    this.apiUrl = `${environment.apiUrl}/auth`;\n    this.currentUserSubject = new BehaviorSubject(null);\n    this.currentUser$ = this.currentUserSubject.asObservable();\n    // Check for existing token on service initialization\n    this.checkAuthStatus();\n  }\n  // Login user\n  login(credentials) {\n    return this.http.post(`${this.apiUrl}/login`, credentials).pipe(map(response => {\n      console.log('AuthService - login response:', response);\n      if (response.success && response.token) {\n        // Store token and user data\n        localStorage.setItem('token', response.token);\n        localStorage.setItem('user', JSON.stringify(response.data));\n        this.currentUserSubject.next(response.data);\n        console.log('AuthService - stored user:', response.data);\n        console.log('AuthService - stored token:', response.token);\n      }\n      return response;\n    }));\n  }\n  // Logout user\n  logout() {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    this.currentUserSubject.next(null);\n  }\n  // Get current user\n  getCurrentUser() {\n    return this.currentUserSubject.value;\n  }\n  // Check if user is authenticated\n  isAuthenticated() {\n    const token = this.getToken();\n    const user = this.getCurrentUser();\n    return !!token && !!user;\n  }\n  // Check if user is admin\n  isAdmin() {\n    const user = this.getCurrentUser();\n    return user?.role === 'admin';\n  }\n  // Get stored token\n  getToken() {\n    return localStorage.getItem('token');\n  }\n  // Get user profile\n  getProfile() {\n    return this.http.get(`${this.apiUrl}/me`).pipe(map(response => response.data));\n  }\n  // Check authentication status on app load\n  checkAuthStatus() {\n    const token = this.getToken();\n    const userStr = localStorage.getItem('user');\n    if (token && userStr) {\n      try {\n        const user = JSON.parse(userStr);\n        this.currentUserSubject.next(user);\n      } catch (error) {\n        // Invalid user data, clear storage\n        this.logout();\n      }\n    }\n  }\n  // Auto-logout when token expires\n  autoLogout() {\n    const token = this.getToken();\n    if (token) {\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        const expirationTime = payload.exp * 1000; // Convert to milliseconds\n        const now = Date.now();\n        if (expirationTime <= now) {\n          this.logout();\n        } else {\n          // Set timeout to logout when token expires\n          setTimeout(() => {\n            this.logout();\n          }, expirationTime - now);\n        }\n      } catch (error) {\n        this.logout();\n      }\n    }\n  }\n  static #_ = this.ɵfac = function AuthService_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || AuthService)(i0.ɵɵinject(i1.HttpClient));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["BehaviorSubject","map","environment","AuthService","constructor","http","apiUrl","currentUserSubject","currentUser$","asObservable","checkAuthStatus","login","credentials","post","pipe","response","console","log","success","token","localStorage","setItem","JSON","stringify","data","next","logout","removeItem","getCurrentUser","value","isAuthenticated","getToken","user","isAdmin","role","getItem","getProfile","get","userStr","parse","error","autoLogout","payload","atob","split","expirationTime","exp","now","Date","setTimeout","_","i0","ɵɵinject","i1","HttpClient","_2","factory","ɵfac","providedIn"],"sources":["C:\\Users\\winni\\OneDrive\\Desktop\\JINZ-Media-Full-Source\\frontend\\src\\app\\core\\services\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, BehaviorSubject } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { environment } from '../../../environments/environment';\r\n\r\nexport interface User {\r\n  _id: string;\r\n  name: string;\r\n  email: string;\r\n  role: 'user' | 'admin';\r\n  isActive: boolean;\r\n  avatar?: string;\r\n  createdAt: Date;\r\n}\r\n\r\nexport interface LoginRequest {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\nexport interface AuthResponse {\r\n  success: boolean;\r\n  token: string;\r\n  data: User;\r\n  message: string;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n  private apiUrl = `${environment.apiUrl}/auth`;\r\n  private currentUserSubject = new BehaviorSubject<User | null>(null);\r\n  public currentUser$ = this.currentUserSubject.asObservable();\r\n\r\n  constructor(private http: HttpClient) {\r\n    // Check for existing token on service initialization\r\n    this.checkAuthStatus();\r\n  }\r\n\r\n  // Login user\r\n  login(credentials: LoginRequest): Observable<AuthResponse> {\r\n    return this.http.post<AuthResponse>(`${this.apiUrl}/login`, credentials).pipe(\r\n      map(response => {\r\n        console.log('AuthService - login response:', response);\r\n        if (response.success && response.token) {\r\n          // Store token and user data\r\n          localStorage.setItem('token', response.token);\r\n          localStorage.setItem('user', JSON.stringify(response.data));\r\n          this.currentUserSubject.next(response.data);\r\n          console.log('AuthService - stored user:', response.data);\r\n          console.log('AuthService - stored token:', response.token);\r\n        }\r\n        return response;\r\n      })\r\n    );\r\n  }\r\n\r\n  // Logout user\r\n  logout(): void {\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    this.currentUserSubject.next(null);\r\n  }\r\n\r\n  // Get current user\r\n  getCurrentUser(): User | null {\r\n    return this.currentUserSubject.value;\r\n  }\r\n\r\n  // Check if user is authenticated\r\n  isAuthenticated(): boolean {\r\n    const token = this.getToken();\r\n    const user = this.getCurrentUser();\r\n    return !!token && !!user;\r\n  }\r\n\r\n  // Check if user is admin\r\n  isAdmin(): boolean {\r\n    const user = this.getCurrentUser();\r\n    return user?.role === 'admin';\r\n  }\r\n\r\n  // Get stored token\r\n  getToken(): string | null {\r\n    return localStorage.getItem('token');\r\n  }\r\n\r\n  // Get user profile\r\n  getProfile(): Observable<User> {\r\n    return this.http.get<{success: boolean, data: User}>(`${this.apiUrl}/me`).pipe(\r\n      map(response => response.data)\r\n    );\r\n  }\r\n\r\n  // Check authentication status on app load\r\n  private checkAuthStatus(): void {\r\n    const token = this.getToken();\r\n    const userStr = localStorage.getItem('user');\r\n    \r\n    if (token && userStr) {\r\n      try {\r\n        const user = JSON.parse(userStr);\r\n        this.currentUserSubject.next(user);\r\n      } catch (error) {\r\n        // Invalid user data, clear storage\r\n        this.logout();\r\n      }\r\n    }\r\n  }\r\n\r\n  // Auto-logout when token expires\r\n  private autoLogout(): void {\r\n    const token = this.getToken();\r\n    if (token) {\r\n      try {\r\n        const payload = JSON.parse(atob(token.split('.')[1]));\r\n        const expirationTime = payload.exp * 1000; // Convert to milliseconds\r\n        const now = Date.now();\r\n        \r\n        if (expirationTime <= now) {\r\n          this.logout();\r\n        } else {\r\n          // Set timeout to logout when token expires\r\n          setTimeout(() => {\r\n            this.logout();\r\n          }, expirationTime - now);\r\n        }\r\n      } catch (error) {\r\n        this.logout();\r\n      }\r\n    }\r\n  }\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}